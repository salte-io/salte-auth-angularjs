!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular"),require("salte-auth")):"function"==typeof define&&define.amd?define("salte-auth-angular",["angular","salte-auth"],t):"object"==typeof exports?exports["salte-auth-angular"]=t(require("angular"),require("salte-auth")):e["salte-auth-angular"]=t(e.angular,e["salte-auth"])}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),i=n(o),a=r(1),u=n(a),s=r(2),c=n(s),l=i["default"].module("salte.auth-angular",[]);l.factory("ProtectedResourceInterceptor",u["default"]),l.provider("salteAuthService",c["default"]),t["default"]=l.name},function(e,t){"use strict";function r(e,t,r){return{request:function(n){if(n){n.headers=n.headers||{};var o=e.getResourceForEndpoint(n.url);if(e.verbose("Url: "+n.url+" maps to resource: "+o),null===o)return n;var i=e.getCachedToken(o);if(i)return e.info("Token is available for this url "+n.url),n.headers.Authorization="Bearer "+i,n;var a;return e.loginInProgress()?e.config.popUp?(e.info("Url: "+n.url+" will be loaded after login is successful"),a=t.defer(),r.$on("salte-auth:loginSuccess",function(t,r){r&&(e.info("Login completed, sending request for "+n.url),n.headers.Authorization="Bearer "+i,a.resolve(n))}),a.promise):(e.info("login is in progress."),n.data="login in progress, cancelling the request for "+n.url,t.reject(n)):(a=t.defer(),e.acquireToken(o).then(function(t){e.verbose("Token is available"),n.headers.Authorization="Bearer "+t,a.resolve(n)},function(e){n.data=e,a.reject(n)}),a.promise)}},responseError:function(n){if(e.info("Getting error in the response."),n){if(401===n.status){var o=e.getResourceForEndpoint(n.config.url);e.clearCacheForResource(o),r.$broadcast("salte-auth:notAuthorized",n,o)}else r.$broadcast("salte-auth:errorResponse",n);return t.reject(n)}}}}r.$inject=["salteAuthService","$q","$rootScope"],Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=null,t={isAuthenticated:!1,userName:"",loginError:"",profile:""},r=function(r){var n=e.getCachedToken(r);t.isAuthenticated=null!==n&&n.length>0;var o=e.getCachedUser()||{userName:""};t.userName=o.userName,t.profile=o.profile,t.loginError=e.getLoginError()};this.init=function(t,n){if(!t)throw new Error("You must set configOptions, when calling init");var o=window.location.hash,a=window.location.href;o&&(a=a.replace(o,"")),t.redirectUri=t.redirectUri||a,t.postLogoutRedirectUri=t.postLogoutRedirectUri||a,t.isAngular=!0,n&&n.interceptors&&n.interceptors.push("ProtectedResourceInterceptor"),e=new i["default"](t),r(e.config.loginResource)},this.$get=function(n,o,i,a,u,s){function c(e,t){return t.requireADLogin?e.requireADLogin!==!1:Boolean(e.requireADLogin)}function l(t){if(e.config&&e.config.anonymousEndpoints)for(var r=0;r<e.config.anonymousEndpoints.length;r++)if(t.indexOf(e.config.anonymousEndpoints[r])>-1)return!0;return!1}function f(e){var t=null,r=[];if(e.hasOwnProperty("parent"))for(t=e;t;)r.unshift(t),t=s.get("$state").get(t.parent);else for(var n=e.name.split("."),o=0,i=n[0];o<n.length;o++)t=s.get("$state").get(i),t&&r.push(t),i+="."+n[o+1];return r}var g=function(i,s,c){e.verbose("Location change event from "+c+" to "+s);var l=o.location.hash,f=o.location.search;if(e.isCallback(l,f)){e.verbose("Processing Callback, Hash: "+l+"; Search String: "+f);var g=e.getRequestInfo(l,f);if(e.saveTokenFromHash(g),g.stateMatch){if(g.requestType===e.REQUEST_TYPE.RENEW_TOKEN){var d=o.parent.AuthenticationContext.callBackMappedToRenewStates[g.stateResponse];if(i.preventDefault(),d&&"function"==typeof d){if(g.parameters.access_token)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),g.parameters.access_token);if(g.parameters.id_token)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),g.parameters.id_token);if(g.parameters.error)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),null)}}else if(g.requestType===e.REQUEST_TYPE.LOGIN)if(r(e.config.loginResource),t.userName?(u(function(){r(e.config.loginResource),n.userInfo=t},1),n.$broadcast("salte-auth:loginSuccess",e._getItem(e.CONSTANTS.STORAGE.IDTOKEN))):n.$broadcast("salte-auth:loginFailure",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION)),e.callback&&"function"==typeof e.callback&&e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),e._getItem(e.CONSTANTS.STORAGE.IDTOKEN)),e.popUp)i.preventDefault();else{var p=e._getItem(e.CONSTANTS.STORAGE.LOGIN_REQUEST);"undefined"!=typeof p&&p&&0!==p.length&&(e.verbose("Redirecting to start page: "+p),!a.$$html5&&p.indexOf("#")>-1&&a.url(p.substring(p.indexOf("#")+1)),o.location=p)}}else n.$broadcast("salte-auth:stateMismatch",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION))}else r(e.config.loginResource),t.isAuthenticated||!t.userName||e._renewActive||(e._renewActive=!0,e.acquireToken(e.config.loginResource,function(r,o){e._renewActive=!1,r?n.$broadcast("salte-auth:loginFailure","auto renew failure"):o&&(t.isAuthenticated=!0)}));u(function(){r(e.config.loginResource),n.userInfo=t},1)},d=function(){e.info("Login event for:"+a.$$url),e.config&&e.config.localLoginUrl?a.path(e.config.localLoginUrl):(e.info("Start login at:"+window.location.href),n.$broadcast("salte-auth:loginRedirect"),e.login(a.absUrl()))},p=function(r,n){if(n&&n.$$route)if(c(n.$$route,e.config))t.isAuthenticated||e._renewActive||e.loginInProgress()||(e.info("Route change event for:"+a.$$url),d());else{var o;o="function"==typeof n.$$route.templateUrl?n.$$route.templateUrl(n.params):n.$$route.templateUrl,o&&!l(o)&&e.config.anonymousEndpoints.push(o)}},h=function(r,n,o,i,u){if(n)for(var s=f(n),g=null,p=0;p<s.length;p++)if(g=s[p],c(g,e.config))t.isAuthenticated||e._renewActive||e.loginInProgress()||(e.info("State change event for:"+a.$$url),d());else if(g.templateUrl){var h;h="function"==typeof g.templateUrl?g.templateUrl(o):g.templateUrl,h&&!l(h)&&e.config.anonymousEndpoints.push(h)}},v=function(t,r,n,o,i,a){e.verbose("State change error occured. Error: "+a),a&&a.data&&(e.info("Setting defaultPrevented to true if state change error occured because the request was rejected. Error: "+a.data),t.preventDefault())};return n.$on("$routeChangeStart",p),n.$on("$stateChangeStart",h),n.$on("$locationChangeStart",g),n.$on("$stateChangeError",v),r(e.config.loginResource),n.userInfo=t,{config:e.config,login:function(){d()},loginInProgress:function(){return e.loginInProgress()},logOut:function(){e.logOut()},getCachedToken:function(t){return e.getCachedToken(t)},userInfo:t,acquireToken:function(t){var r=i.defer();return e._renewActive=!0,e.acquireToken(t,function(n,o){e._renewActive=!1,n?(e.error("Error when acquiring token for resource: "+t,n),r.reject(n)):r.resolve(o)}),r.promise},getUser:function(){var t=i.defer();return e.getUser(function(r,n){r?(e.error("Error when getting user",r),t.reject(r)):t.resolve(n)}),t.promise},getResourceForEndpoint:function(t){return e.getResourceForEndpoint(t)},clearCache:function(){e.clearCache()},clearCacheForResource:function(t){e.clearCacheForResource(t)},info:function(t){e.info(t)},verbose:function(t){e.verbose(t)},salteAuth:e}},this.$get.$inject=["$rootScope","$window","$q","$location","$timeout","$injector"]};var o=r(4),i=n(o)},function(t,r){t.exports=e},function(e,r){e.exports=t}])});
//# sourceMappingURL=salte-auth-angular.js.map