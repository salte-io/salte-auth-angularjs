!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular"),require("salte-auth")):"function"==typeof define&&define.amd?define("salte-auth-angular",["angular","salte-auth"],t):"object"==typeof exports?exports["salte-auth-angular"]=t(require("angular"),require("salte-auth")):e["salte-auth-angular"]=t(e.angular,e["salte-auth"])}(this,function(e,t){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=o(n),a=r(1),u=o(a),c=r(2),s=o(c),l=i["default"].module("salte.auth-angular",[]);l.factory("ProtectedResourceInterceptor",u["default"]),l.provider("salteAuthService",s["default"]),t["default"]=l.name},function(e,t){"use strict";function r(e,t,r){return{request:function(n){if(n){var i=function(){n.headers=n.headers||{};var o=e.getResourceForEndpoint(n.url);if(e.verbose("Url: "+n.url+" maps to resource: "+o),null===o)return{v:n};var i=e.getCachedToken(o);if(i)return e.info("Token is available for this url "+n.url),n.headers.Authorization="Bearer "+i,{v:n};var a=void 0;return e.loginInProgress()?e.config.popUp?(e.info("Url: "+n.url+" will be loaded after login is successful"),a=t.defer(),r.$on("salte-auth:loginSuccess",function(t,r){r&&(e.info("Login completed, sending request for "+n.url),n.headers.Authorization="Bearer "+i,a.resolve(n))}),{v:a.promise}):(e.info("login is in progress."),n.data="login in progress, cancelling the request for "+n.url,{v:t.reject(n)}):(a=t.defer(),e.acquireToken(o).then(function(t){e.verbose("Token is available"),n.headers.Authorization="Bearer "+t,a.resolve(n)},function(e){n.data=e,a.reject(n)}),{v:a.promise})}();if("object"===("undefined"==typeof i?"undefined":o(i)))return i.v}},responseError:function(o){if(e.info("Getting error in the response."),o){if(401===o.status){var n=e.getResourceForEndpoint(o.config.url);e.clearCacheForResource(n),r.$broadcast("salte-auth:notAuthorized",o,n)}else r.$broadcast("salte-auth:errorResponse",o);return t.reject(o)}}}}r.$inject=["salteAuthService","$q","$rootScope"],Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t["default"]=r},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=null,t={isAuthenticated:!1,userName:"",loginError:"",profile:""},r=function(r){var o=e.getCachedToken(r);t.isAuthenticated=null!==o&&o.length>0;var n=e.getCachedUser()||{userName:""};t.userName=n.userName,t.profile=n.profile,t.loginError=e.getLoginError()};this.init=function(t,o){if(!t)throw new Error("You must set configOptions, when calling init");var n=window.location.hash,a=window.location.href;n&&(a=a.replace(n,"")),t.redirectUri=t.redirectUri||a,t.postLogoutRedirectUri=t.postLogoutRedirectUri||a,t.isAngular=!0,o&&o.interceptors&&o.interceptors.push("ProtectedResourceInterceptor"),e=new i["default"](t),r(e.config.loginResource)},this.$get=function(o,n,i,a,u,c){function s(e,t){return t.requireADLogin?e.requireADLogin!==!1:Boolean(e.requireADLogin)}function l(t){if(e.config&&e.config.anonymousEndpoints)for(var r=0;r<e.config.anonymousEndpoints.length;r++)if(t.indexOf(e.config.anonymousEndpoints[r])>-1)return!0;return!1}function f(e){var t=null,r=[];if(e.hasOwnProperty("parent"))for(t=e;t;)r.unshift(t),t=c.get("$state").get(t.parent);else for(var o=e.name.split("."),n=0,i=o[0];n<o.length;n++)t=c.get("$state").get(i),t&&r.push(t),i+="."+o[n+1];return r}var g=function(i,c,s){e.verbose("Location change event from "+s+" to "+c);var l=n.location.hash,f=n.location.search;if(e.isCallback(l,f)){e.verbose("Processing Callback, Hash: "+l+"; Search String: "+f);var g=e.getRequestInfo(l,f);if(e.saveTokenFromHash(g),g.stateMatch){if(g.requestType===e.REQUEST_TYPE.RENEW_TOKEN){var d=n.parent.AuthenticationContext.callBackMappedToRenewStates[g.stateResponse];if(i.preventDefault(),d&&"function"==typeof d){if(g.parameters.access_token)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),g.parameters.access_token);if(g.parameters.id_token)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),g.parameters.id_token);if(g.parameters.error)return void d(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),null)}}else if(g.requestType===e.REQUEST_TYPE.LOGIN)if(r(e.config.loginResource),t.userName?(u(function(){r(e.config.loginResource),o.userInfo=t},1),o.$broadcast("salte-auth:loginSuccess",e._getItem(e.CONSTANTS.STORAGE.IDTOKEN))):o.$broadcast("salte-auth:loginFailure",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION)),e.callback&&"function"==typeof e.callback&&e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),e._getItem(e.CONSTANTS.STORAGE.IDTOKEN)),e.popUp)i.preventDefault();else{var p=e._getItem(e.CONSTANTS.STORAGE.LOGIN_REQUEST);"undefined"!=typeof p&&p&&0!==p.length&&(e.verbose("Redirecting to start page: "+p),!a.$$html5&&p.indexOf("#")>-1&&a.url(p.substring(p.indexOf("#")+1)),n.location=p)}}else o.$broadcast("salte-auth:stateMismatch",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION))}else r(e.config.loginResource),t.isAuthenticated||!t.userName||e._renewActive||(e._renewActive=!0,e.acquireToken(e.config.loginResource,function(r,n){e._renewActive=!1,r?o.$broadcast("salte-auth:loginFailure","auto renew failure"):n&&(t.isAuthenticated=!0)}));u(function(){r(e.config.loginResource),o.userInfo=t},1)},d=function(){e.info("Login event for:"+a.$$url),e.config&&e.config.localLoginUrl?a.path(e.config.localLoginUrl):(e.info("Start login at:"+window.location.href),o.$broadcast("salte-auth:loginRedirect"),e.login(a.absUrl()))},p=function(r,o){if(o&&o.$$route)if(s(o.$$route,e.config))t.isAuthenticated||e._renewActive||e.loginInProgress()||(e.info("Route change event for:"+a.$$url),d());else{var n=void 0;n="function"==typeof o.$$route.templateUrl?o.$$route.templateUrl(o.params):o.$$route.templateUrl,n&&!l(n)&&e.config.anonymousEndpoints.push(n)}},h=function(r,o,n,i,u){if(o)for(var c=f(o),g=null,p=0;p<c.length;p++)if(g=c[p],s(g,e.config))t.isAuthenticated||e._renewActive||e.loginInProgress()||(e.info("State change event for:"+a.$$url),d());else if(g.templateUrl){var h=void 0;h="function"==typeof g.templateUrl?g.templateUrl(n):g.templateUrl,h&&!l(h)&&e.config.anonymousEndpoints.push(h)}},v=function(t,r,o,n,i,a){e.verbose("State change error occured. Error: "+a),a&&a.data&&(e.info("Setting defaultPrevented to true if state change error occured because the request was rejected. Error: "+a.data),t.preventDefault())};return o.$on("$routeChangeStart",p),o.$on("$stateChangeStart",h),o.$on("$locationChangeStart",g),o.$on("$stateChangeError",v),r(e.config.loginResource),o.userInfo=t,{config:e.config,login:function(){d()},loginInProgress:function(){return e.loginInProgress()},logOut:function(){e.logOut()},getCachedToken:function(t){return e.getCachedToken(t)},userInfo:t,acquireToken:function(t){var r=i.defer();return e._renewActive=!0,e.acquireToken(t,function(o,n){e._renewActive=!1,o?(e.error("Error when acquiring token for resource: "+t,o),r.reject(o)):r.resolve(n)}),r.promise},getUser:function(){var t=i.defer();return e.getUser(function(r,o){r?(e.error("Error when getting user",r),t.reject(r)):t.resolve(o)}),t.promise},getResourceForEndpoint:function(t){return e.getResourceForEndpoint(t)},clearCache:function(){e.clearCache()},clearCacheForResource:function(t){e.clearCacheForResource(t)},info:function(t){e.info(t)},verbose:function(t){e.verbose(t)},salteAuth:e}},this.$get.$inject=["$rootScope","$window","$q","$location","$timeout","$injector"]};var n=r(4),i=o(n)},function(t,r){t.exports=e},function(e,r){e.exports=t}])});
//# sourceMappingURL=salte-auth-angular.js.map